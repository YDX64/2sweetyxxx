<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2sweety – TAM KURULUM & CI/CD REHBERİ (2 Ortam)</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",Tahoma,sans-serif}
    body{background:linear-gradient(135deg,#8e2de2 0%,#4a00e0 100%);min-height:100vh;padding:24px;color:#2d3748}
    .wrapper{max-width:1300px;margin:auto;background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.2);overflow:hidden}
    header{background:linear-gradient(135deg,#00b894 0%,#00a06b 100%);color:#fff;padding:40px;text-align:center}
    header h1{font-size:2.4em;margin-bottom:8px}
    header p{opacity:.9}
    section{padding:40px}
    h2{margin-bottom:20px;color:#333}
    .step{margin:30px 0;padding:30px;border-left:6px solid #8e2de2;border-radius:12px;background:#f8f9fa}
    .step h3{margin-bottom:15px;color:#8e2de2}
    pre{background:#2d3748;color:#e2e8f0;padding:20px;border-radius:10px;overflow-x:auto;line-height:1.55;font-size:.9em}
    code{white-space:pre-wrap}
    .warning{background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%);color:#fff;padding:24px;border-radius:10px;margin:20px 0}
    .info{background:linear-gradient(135deg,#74b9ff 0%,#0984e3 100%);color:#fff;padding:24px;border-radius:10px;margin:20px 0}
    ul{margin-left:20px}
    li{margin:6px 0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
    @media(max-width:600px){header h1{font-size:1.8em};section{padding:24px};pre{font-size:.8em}}
  </style>
</head>
<body>
  <div class="wrapper">
    <header>
      <h1>🚀 2sweety – Tam Kurulum & CI/CD Rehberi</h1>
      <p>Ubuntu 24.04 • Coolify • GitHub • Supabase • Stripe • 2 Ortam (dev/staging + prod)</p>
    </header>
    <section>
      <div class="info">
        <strong>Kısaca:</strong> Hedefimiz <code>dev.2sweety.com</code> ve <code>2sweety.com</code> için eksiksiz, güvenli ve hızlı bir kurulum.
      </div>

      <div class="step" id="prereq">
        <h3>1️⃣ Sunucu Ön Hazırlığı (Ubuntu 24.04)</h3>
        <ul>
          <li>IP: <strong>45.9.190.79</strong> (örnek)</li>
          <li>Kullanıcı: <code>root</code> veya sudo yetkili başka kullanıcı</li>
          <li>SSH portu: <code>22</code> (değiştirilebilir)</li>
        </ul>
        <pre><code># Sunucuya bağlan
ssh root@45.9.190.79

# Güncelle & temel araçlar
apt update && apt upgrade -y
apt install -y git curl ufw

# Güvenlik duvarı (isteğe bağlı)
ufw allow OpenSSH
ufw enable

# Saat dilimini ayarla
timedatectl set-timezone Europe/Istanbul
        </code></pre>
      </div>

      <div class="step" id="docker">
        <h3>2️⃣ Docker + Docker Compose Kurulumu</h3>
        <pre><code># Docker resmi script ile kur
curl -fsSL https://get.docker.com | sh

# Docker Compose plugin
apt install -y docker-compose-plugin

# Docker yetkisi (root dışı kullanıcı için)
useradd -m -s /bin/bash devops
usermod -aG docker devops
        </code></pre>
        <p>SSH ile çıkıp <code>devops</code> kullanıcısı ile tekrar bağlanın:</p>
        <pre><code>exit
ssh devops@45.9.190.79</code></pre>
      </div>

      <div class="step" id="coolify">
        <h3>3️⃣ Coolify V3 Kurulumu</h3>
        <pre><code># Coolify klasörü
mkdir ~/coolify && cd ~/coolify

# Coolify'ı kendi docker-compose dosyasıyla kuralım
curl -o docker-compose.yml https://raw.githubusercontent.com/coollabsio/coolify/master/docker-compose.yml

# Coolify için env dosyası (basit)
cat << 'EOF' > .env
COOLIFY_HOSTNAME=coolify.2sweety.com
COOLIFY_SECRET=$(openssl rand -hex 32)
EOF

# Coolify servisini ayağa kaldır
docker compose up -d
        </code></pre>
        <p><strong>DNS:</strong> <code>coolify.2sweety.com</code> A kaydı → <code>45.9.190.79</code></p>
        <div class="warning">İlk kurulum 2-3 dk sürebilir. <code>https://coolify.2sweety.com</code> açılınca admin hesabı oluşturun.</div>
      </div>

      <div class="step" id="github">
        <h3>4️⃣ Sunucudan GitHub'a Erişim (Deploy Key)</h3>
        <pre><code># Anahtar oluştur (devops kullanıcısı)
ssh-keygen -t ed25519 -C "coolify@2sweety" -f ~/.ssh/id_coolify -N ""
cat ~/.ssh/id_coolify.pub  # kopyala</code></pre>
        <p>GitHub → Repo → <strong>Settings › Deploy Keys</strong> → Add Key → Read/Write → anahtarı yapıştır.</p>
      </div>

      <div class="step" id="supabase-dev">
        <h3>5️⃣ Supabase (Development/Staging Projesi)</h3>
        <ol>
          <li><strong>Supabase Dashboard › New Project</strong></li>
          <li>Name: <code>2sweety-development</code></li>
          <li>Region: production ile aynı seç</li>
          <li>Plan: Free tier (yeterli)</li>
        </ol>
        <p>Oluştuktan sonra:</p>
        <ul>
          <li><strong>Project URL</strong> ve <strong>anon/public key</strong> kopyala</li>
          <li>SQL Editor › seed verilerini ve schema'yı import et (<em>production export</em>)</li>
          <li><strong>Auth › Settings</strong> bölümünde <code>http://dev.2sweety.com</code> ekle</li>
        </ul>
      </div>

      <div class="step" id="stripe-test">
        <h3>6️⃣ Stripe Test Anahtarları</h3>
        <p><strong>Dashboard › Developers › API keys</strong></p>
        <ul>
          <li><code>STRIPE_SECRET_KEY = sk_test_...</code></li>
          <li><code>STRIPE_PUBLISHABLE_KEY = pk_test_...</code></li>
          <li>Webhook endpoint: <code>https://dev.2sweety.com/api/stripe/webhook</code></li>
        </ul>
      </div>

      <div class="step" id="env-files">
        <h3>7️⃣ .env Dosyalarını Oluştur</h3>
        <div class="grid">
          <div>
            <h4>.env.development</h4>
            <pre><code>SUPABASE_URL=https://dev-id.supabase.co
SUPABASE_ANON_KEY=dev-anon-key
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
NEXT_PUBLIC_ENV=development
</code></pre>
          </div>
          <div>
            <h4>.env.production</h4>
            <pre><code>SUPABASE_URL=https://prod-id.supabase.co
SUPABASE_ANON_KEY=prod-anon-key
STRIPE_SECRET_KEY=sk_live_...
STRIPE_PUBLISHABLE_KEY=pk_live_...
NEXT_PUBLIC_ENV=production
</code></pre>
          </div>
        </div>
        <p>Dosyaları repo köküne ekleyip <strong>git crypt</strong> ya da GitHub Secrets kullanabilirsiniz.</p>
      </div>

      <div class="step" id="coolify-apps">
        <h3>8️⃣ Coolify'de Application Oluştur</h3>
        <h4>🔹 Development/Staging</h4>
        <ul>
          <li>Coolify › New Application</li>
          <li>Source: GitHub</li>
          <li>Repo: <code>github.com/&lt;user&gt;/2sweety</code></li>
          <li>Branch: <code>development</code></li>
          <li>Build Pack: <strong>Dockerfile</strong> veya <em>Node + Next.js</em></li>
          <li>Domain: <code>https://dev.2sweety.com</code></li>
          <li>Environment Variables sekmesine <strong>.env.development</strong> içeriklerini ekle</li>
          <li>Auto-Deploy ON</li>
        </ul>
        <h4>🔴 Production</h4>
        <ul>
          <li>Yeni Application → Branch: <code>main</code></li>
          <li>Domain: <code>https://2sweety.com</code></li>
          <li>Environment Variables: <strong>.env.production</strong></li>
        </ul>
        <div class="info">Coolify Let's Encrypt sertifikasını otomatik alır. DNS A kayıtları ✅ olmalı.</div>
      </div>

      <div class="step" id="dns">
        <h3>9️⃣ DNS Kayıtları (Hostinger)</h3>
        <table style="width:100%;border-collapse:collapse">
          <tr style="background:#eaf2ff"><th>Tip</th><th>Ad</th><th>Değer</th><th>TTL</th></tr>
          <tr><td>A</td><td>@</td><td>45.9.190.79</td><td>300</td></tr>
          <tr><td>A</td><td>dev</td><td>45.9.190.79</td><td>300</td></tr>
          <tr><td>A</td><td>coolify</td><td>45.9.190.79</td><td>300</td></tr>
          <tr><td>CAA</td><td>@</td><td>letsencrypt.org</td><td>0</td></tr>
        </table>
        <p>Değişiklik sonrası yayılma genelde 1-5 dk.</p>
      </div>

      <div class="step" id="deploy-test">
        <h3>🔟 İlk Deploy & Test</h3>
        <pre><code># Lokalde yeni feature geliştir
git checkout -b feature/chat-system
# kod...

git add . && git commit -m "feat: chat system"
git push origin feature/chat-system

# PR → development branch'e merge
# Coolify otomatik deploy → https://dev.2sweety.com
        </code></pre>
        <ul>
          <li>Tarayıcıda <code>dev.2sweety.com</code> aç → Login → Stripe test ödemesini dene</li>
          <li>Console & network hatalarını kontrol et</li>
        </ul>
      </div>

      <div class="step" id="promote">
        <h3>1️⃣1️⃣ Production'a Çıkarma</h3>
        <pre><code># development → main merge et

# PR aç
# Code review → approval
# Merge main
# Coolify production uygulaması otomatik deploy
        </code></pre>
        <p>Production'da smoke test yap: login, ödeme, media upload.</p>
      </div>

      <div class="info">
        <strong>Artık hazırsınız!</strong> 2 ortamlı sistem <em>tamamlandı</em> ve gerçek verilerle anında test edebilirsiniz.
      </div>

      <div class="warning">
        🛡️ <strong>İpucu:</strong> <code>coolify-backups</code> add-on'u ile günlük yedek alın. Ayrıca Supabase › Backups menüsünden otomatik yedeklemeyi aktif edin.
      </div>
    </section>
  </div>
</body>
</html> 